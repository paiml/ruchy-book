// BENCH-002: Matrix Multiplication (100x100) - Ruchy

// Simple LCG PRNG for deterministic test data
let mut lcg_state = 0

fun lcg_seed(seed) {
    lcg_state = seed
}

fun lcg_random() {
    lcg_state = (lcg_state * 1103515245 + 12345) % 2147483648
    lcg_state / 2147483648.0
}

fun create_matrix(n) {
    let matrix = []
    let mut i = 0
    while i < n {
        let row = []
        let mut j = 0
        while j < n {
            row.push(0.0)
            j = j + 1
        }
        matrix.push(row)
        i = i + 1
    }
    matrix
}

fun create_test_matrix(n, seed) {
    lcg_seed(seed)
    let matrix = []
    let mut i = 0
    while i < n {
        let row = []
        let mut j = 0
        while j < n {
            row.push(lcg_random())
            j = j + 1
        }
        matrix.push(row)
        i = i + 1
    }
    matrix
}

fun matrix_multiply(a, b, n) {
    let result = create_matrix(n)

    let mut i = 0
    while i < n {
        let mut j = 0
        while j < n {
            let mut k = 0
            while k < n {
                result[i][j] = result[i][j] + a[i][k] * b[k][j]
                k = k + 1
            }
            j = j + 1
        }
        i = i + 1
    }

    result
}

// Generate test matrices (fixed seed for reproducibility)
let n = 100
let matrix_a = create_test_matrix(n, 42)
let matrix_b = create_test_matrix(n, 43)

// Execute benchmark
let result = matrix_multiply(matrix_a, matrix_b, n)

// Output checksum for verification
let mut checksum = 0.0
let mut i = 0
while i < n {
    let mut j = 0
    while j < n {
        checksum = checksum + result[i][j]
        j = j + 1
    }
    i = i + 1
}

println(checksum)
// Expected: 248683.505429
