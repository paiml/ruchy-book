// feature_flags.ruchy
use feature_flags::{Client, Flag};

let flags = Client::new("api_key")

// Define feature flag
let new_algorithm = Flag::new("new-algorithm")
    .default(false)
    .rollout_percentage(10)  // 10% of users
    .targeting_rules([
        Rule::new("beta_users", true),
        Rule::new("internal_users", true)
    ])

// Use in code
if flags.is_enabled(new_algorithm, user) {
    use_new_algorithm()
} else {
    use_old_algorithm()
}

// Gradual rollout
for percentage in [10, 25, 50, 75, 100] {
    flags.set_rollout(new_algorithm, percentage)
    monitor_metrics()
    
    if metrics_degraded() {
        flags.disable(new_algorithm)
        break
    }
}