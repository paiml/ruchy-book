// File: log_analyzer.ruchy
// Analyzes server log files

println("=== Log Analyzer ===")
let log_file = input("Enter log file path: ")

let lines = read_lines(log_file)
let total_requests = lines.len()

// Count different status codes
let success_count = 0
let error_count = 0
let not_found_count = 0

for line in lines {
    if line.contains(" 200 ") {
        success_count += 1
    } else if line.contains(" 404 ") {
        not_found_count += 1
    } else if line.contains(" 500 ") {
        error_count += 1
    }
}

// Calculate percentages
let success_percent = (success_count * 100) / total_requests
let error_percent = (error_count * 100) / total_requests
let not_found_percent = (not_found_count * 100) / total_requests

println(f"\n=== Analysis Results ===")
println(f"Total Requests: {total_requests}")
println(f"Success (200): {success_count} ({success_percent}%)")
println(f"Not Found (404): {not_found_count} ({not_found_percent}%)")
println(f"Server Error (500): {error_count} ({error_percent}%)")

// Find busiest hour
let hour_counts = {}
for line in lines {
    let timestamp = extract_hour(line)  // Custom function
    hour_counts[timestamp] = hour_counts.get(timestamp, 0) + 1
}

let busiest_hour = hour_counts.max_by_value().key
println(f"Busiest Hour: {busiest_hour}:00")