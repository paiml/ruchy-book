// WebSocket Server
let ws_server = ws::Server::new("0.0.0.0:8081")

ws_server.on_connection(|socket| {
    println(f"WebSocket connected: {socket.id}")
    
    socket.on("message", |data| {
        println(f"Received: {data}")
        
        // Broadcast to all clients
        ws_server.broadcast({
            type: "chat",
            user: socket.id,
            message: data
        })
    })
    
    socket.on("close", || {
        println(f"WebSocket disconnected: {socket.id}")
    })
})

ws_server.listen()

// WebSocket Client
let ws = ws::connect("ws://localhost:8081")

ws.on("open", || {
    println("Connected to server")
    ws.send("Hello, server!")
})

ws.on("message", |data| {
    println(f"Server says: {data}")
})

ws.on("error", |err| {
    println(f"WebSocket error: {err}")
})